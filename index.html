<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aleela Trade - Online Grocery Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqdg6ePdCGvlzHpaEFgOUFPaHEsPYIApw&callback=initMap&libraries=places" async defer></script>
    <style>
        /* ===== 2026 MODERN DESIGN SYSTEM ===== */
        :root {
            --primary: #2ecc71;
            --primary-dark: #27ae60;
            --secondary: #3498db;
            --accent: #9b59b6;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --fresh: #2ecc71;
            --organic: #27ae60;
            --fruit: #e74c3c;
            --vegetable: #27ae60;
            --dairy: #3498db;
            --meat: #e74c3c;
            --bakery: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ===== 2026 LOADING ANIMATION ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            visibility: visible;
            transition: all var(--transition-slow);
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .logo-animation {
            width: 200px;
            height: 200px;
            position: relative;
            margin-bottom: 2rem;
        }

        .company-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .company-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
        }

        .line-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .line {
            position: absolute;
            border: 2px solid transparent;
            border-radius: 50%;
            animation: lineRotate 2s linear infinite;
        }

        .line-1 {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-top-color: white;
            animation-delay: 0s;
        }

        .line-2 {
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            border-right-color: rgba(255, 255, 255, 0.8);
            animation-delay: 0.2s;
        }

        .line-3 {
            top: 20px;
            left: 20px;
            width: calc(100% - 40px);
            height: calc(100% - 40px);
            border-bottom-color: rgba(255, 255, 255, 0.6);
            animation-delay: 0.4s;
        }

        .line-4 {
            top: 30px;
            left: 30px;
            width: calc(100% - 60px);
            height: calc(100% - 60px);
            border-left-color: rgba(255, 255, 255, 0.4);
            animation-delay: 0.6s;
        }

        @keyframes lineRotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-dots {
            display: flex;
            gap: 0.5rem;
            margin-top: 2rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: dotBounce 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes dotBounce {
            0%, 80%, 100% { 
                transform: scale(0);
                opacity: 0.5;
            }
            40% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* ===== HEADER - MOBILE FIRST ===== */
        header {
            background: white;
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            border-bottom: 1px solid var(--gray-200);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
            gap: 1rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .brand-logo {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            color: white;
            font-size: 1.25rem;
        }

        .brand-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .action-btn:hover {
            background: var(--gray-200);
            color: var(--primary);
        }

        .action-btn.active {
            background: var(--primary);
            color: white;
        }

        .cart-badge, .favorites-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 24px;
            height: 18px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .menu-toggle span {
            display: block;
            width: 100%;
            height: 2px;
            background: var(--gray-700);
            border-radius: 1px;
            transition: all var(--transition-normal);
        }

        .menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 72px;
            left: 0;
            width: 100%;
            height: calc(100vh - 72px);
            background: white;
            transform: translateX(-100%);
            transition: transform var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            overflow-y: auto;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            opacity: 0;
        }

        nav.active {
            transform: translateX(0);
            opacity: 1;
        }

        .nav-categories {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .category-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius-md);
            color: var(--gray-700);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateX(-20px);
        }

        .category-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .category-btn:hover::before {
            transform: translateX(0);
        }

        .category-btn.active::before {
            transform: translateX(0);
        }

        .category-btn:hover {
            background: var(--gray-200);
            transform: translateX(4px);
        }

        .category-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            color: white;
        }

        .nav-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-link {
            padding: 0.875rem 1rem;
            text-decoration: none;
            color: var(--gray-600);
            font-weight: 500;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateX(-20px);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .nav-link:hover::after {
            transform: translateX(0);
        }

        .nav-link.active::after {
            transform: translateX(0);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .nav-link:hover i {
            transform: scale(1.2);
            color: var(--primary);
        }

        .nav-link.active i {
            transform: scale(1.2);
            color: white;
        }

        .nav-link:hover {
            background: var(--gray-100);
            color: var(--primary);
            transform: translateX(4px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            color: white;
        }

        /* Sidebar overlay effect */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* ===== AUTH MODALS ===== */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1001;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 95%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: 1rem;
            box-shadow: var(--shadow-xl);
        }

        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-500);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .auth-tab.active {
            color: var(--primary);
        }

        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        .auth-body {
            padding: 2rem;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
            text-align: center;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .auth-message {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 500;
        }

        .auth-message.success {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success);
            border: 1px solid rgba(46, 204, 113, 0.2);
        }

        .auth-message.error {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        .auth-message.info {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        /* ===== MAIN CONTENT ===== */
        main {
            padding: 1rem 0 3rem;
            min-height: calc(100vh - 200px);
        }

        /* Page Header */
        .page-header {
            margin-bottom: 2rem;
            padding: 0.5rem 0;
        }

        .page-header h1 {
            font-size: 1.875rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .page-header p {
            color: var(--gray-500);
            font-size: 1rem;
        }

        /* Product Grid - 2 Products Per Row on Mobile */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        @media (min-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.25rem;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                gap: 0.75rem;
            }
        }

        .product-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            position: relative;
            border: 1px solid var(--gray-200);
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .product-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: linear-gradient(135deg, var(--fresh) 0%, var(--organic) 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1;
        }

        .favorite-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            font-size: 1.125rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 1;
            box-shadow: var(--shadow-sm);
        }

        .favorite-btn:hover {
            color: var(--danger);
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: var(--danger);
            background: rgba(231, 76, 60, 0.1);
        }

        .product-image {
            width: 100%;
            height: 160px;
            overflow: hidden;
            background: var(--gray-100);
            position: relative;
        }

        @media (min-width: 768px) {
            .product-image {
                height: 200px;
            }
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-content {
            padding: 1rem;
        }

        @media (min-width: 768px) {
            .product-content {
                padding: 1.25rem;
            }
        }

        .product-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .product-title {
                font-size: 1.125rem;
            }
        }

        .product-description {
            color: var(--gray-500);
            font-size: 0.75rem;
            margin-bottom: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .product-description {
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .current-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary);
        }

        @media (min-width: 768px) {
            .current-price {
                font-size: 1.5rem;
            }
        }

        .original-price {
            font-size: 0.875rem;
            color: var(--gray-400);
            text-decoration: line-through;
        }

        .stock-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        @media (min-width: 768px) {
            .stock-status {
                padding: 0.375rem 0.75rem;
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }
        }

        .stock-in {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success);
        }

        .stock-low {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .stock-out {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        @media (min-width: 768px) {
            .product-actions {
                gap: 0.75rem;
            }
        }

        /* ===== IMAGE SLIDER ===== */
        .slider-container {
            width: 100%;
            overflow: hidden;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            position: relative;
        }

        .slider {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            min-width: 100%;
            height: 250px;
            position: relative;
        }

        @media (min-width: 768px) {
            .slide {
                height: 400px;
            }
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            color: white;
            padding: 1.5rem;
        }

        .slide-content h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        @media (min-width: 768px) {
            .slide-content h2 {
                font-size: 2rem;
            }
        }

        .slider-dots {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .slider-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-300);
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            padding: 0;
        }

        .slider-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        /* ===== PRODUCT DETAILS MODAL ===== */
        .product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1001;
            overflow-y: auto;
        }

        .product-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 95%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: 1rem;
            box-shadow: var(--shadow-xl);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--gray-600);
            cursor: pointer;
            z-index: 2;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-image {
            width: 100%;
            height: 300px;
            overflow: hidden;
            background: var(--gray-100);
        }

        .modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .modal-price {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .modal-description {
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-specs {
            margin-bottom: 1.5rem;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .spec-label {
            color: var(--gray-600);
        }

        .spec-value {
            font-weight: 600;
            color: var(--dark);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* ===== BANK TRANSFER MODAL - UPDATED STYLE ===== */
        .bank-transfer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1002;
            overflow-y: auto;
        }

        .bank-transfer-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bank-transfer-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 95%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: 1rem;
            box-shadow: var(--shadow-xl);
        }

        .bank-details {
            padding: 2rem;
        }

        .bank-details-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
            text-align: center;
        }

        .order-summary-box {
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            color: white;
        }

        .summary-amount {
            text-align: center;
            margin-bottom: 1rem;
        }

        .amount-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .amount-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .amount-currency {
            font-size: 1rem;
            opacity: 0.9;
        }

        .summary-note {
            font-size: 0.875rem;
            text-align: center;
            opacity: 0.9;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .bank-info {
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .bank-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .bank-info-item:last-child {
            border-bottom: none;
        }

        .bank-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .bank-value {
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .copy-btn:hover {
            background: var(--danger);
        }

        .copy-btn.copied {
            background: var(--success);
        }

        .upload-receipt {
            margin-top: 2rem;
        }

        .upload-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--dark);
        }

        .upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-md);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: 1rem;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(46, 204, 113, 0.02);
        }

        .upload-area i {
            font-size: 2rem;
            color: var(--gray-400);
            margin-bottom: 1rem;
        }

        .upload-area p {
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .upload-area small {
            color: var(--gray-400);
        }

        .file-preview {
            display: none;
            align-items: center;
            gap: 1rem;
            background: var(--gray-100);
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-top: 1rem;
        }

        .file-preview i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .file-size {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        .remove-file {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.25rem;
        }

        /* ===== MAP MODAL ===== */
        .map-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1002;
            overflow-y: auto;
        }

        .map-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: 1rem;
            box-shadow: var(--shadow-xl);
        }

        #map {
            width: 100%;
            height: 400px;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .map-info {
            padding: 1.5rem;
        }

        .map-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .map-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* ===== BUTTONS - 2026 STYLE ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            width: 44px;
            padding: 0;
            flex-shrink: 0;
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* ===== CART PAGE - MOBILE OPTIMIZED ===== */
        .cart-container {
            display: grid;
            gap: 1.5rem;
        }

        @media (max-width: 767px) {
            .cart-container {
                grid-template-columns: 1fr;
            }
            
            .cart-summary-mobile {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 1rem;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
                z-index: 100;
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            }
            
            .cart-summary-desktop {
                display: none;
            }
        }

        @media (min-width: 768px) {
            .cart-container {
                grid-template-columns: 2fr 1fr;
            }
            
            .cart-summary-mobile {
                display: none;
            }
            
            .cart-summary-desktop {
                display: block;
            }
        }

        .cart-items {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .cart-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1rem;
            padding: 1.25rem 0;
            border-bottom: 1px solid var(--gray-200);
            align-items: start;
        }

        @media (max-width: 480px) {
            .cart-item {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .cart-item-image {
                width: 100%;
                height: 200px;
            }
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-md);
            object-fit: cover;
            background: var(--gray-100);
        }

        .cart-item-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .cart-item-title {
            font-weight: 600;
            color: var(--dark);
            line-height: 1.4;
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.125rem;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--gray-600);
            transition: all var(--transition-fast);
        }

        .quantity-btn:hover {
            background: var(--gray-200);
            color: var(--primary);
        }

        .quantity-input {
            width: 50px;
            height: 32px;
            text-align: center;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
        }

        .remove-btn {
            background: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .remove-btn:hover {
            background: rgba(231, 76, 60, 0.1);
        }

        /* Order Summary */
        .order-summary {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        @media (min-width: 768px) {
            .order-summary {
                position: sticky;
                top: 1rem;
            }
        }

        .summary-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-600);
        }

        .summary-row.total {
            border-bottom: none;
            border-top: 2px solid var(--gray-200);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .summary-row.total .value {
            color: var(--primary);
        }

        .checkout-btn {
            width: 100%;
            margin-top: 1.5rem;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: var(--gray-400);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--gray-500);
            margin-bottom: 2rem;
        }

        /* ===== CHECKOUT PAGE ===== */
        .checkout-container {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .checkout-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .checkout-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all var(--transition-fast);
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .payment-method:hover {
            border-color: var(--primary);
            background: rgba(46, 204, 113, 0.02);
        }

        .payment-method.selected {
            border-color: var(--primary);
            background: rgba(46, 204, 113, 0.05);
        }

        .payment-icon {
            width: 40px;
            height: 40px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            font-size: 1.25rem;
        }

        .payment-details {
            flex: 1;
        }

        .payment-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .payment-desc {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        /* ===== FOOTER ===== */
        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 1.5rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .footer-content {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .footer-section h3 {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.25rem;
            color: white;
        }

        .footer-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .footer-links a {
            color: var(--gray-300);
            text-decoration: none;
            transition: color var(--transition-fast);
            font-size: 0.875rem;
        }

        .footer-links a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .social-link {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            transition: all var(--transition-fast);
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-400);
            font-size: 0.875rem;
        }

        /* Category specific styles */
        .category-fruit {
            background: rgba(231, 76, 60, 0.1) !important;
            border-left: 4px solid var(--fruit) !important;
        }

        .category-vegetable {
            background: rgba(39, 174, 96, 0.1) !important;
            border-left: 4px solid var(--vegetable) !important;
        }

        .category-dairy {
            background: rgba(52, 152, 219, 0.1) !important;
            border-left: 4px solid var(--dairy) !important;
        }

        .category-meat {
            background: rgba(231, 76, 60, 0.1) !important;
            border-left: 4px solid var(--meat) !important;
        }

        .category-bakery {
            background: rgba(243, 156, 18, 0.1) !important;
            border-left: 4px solid var(--bakery) !important;
        }

        .category-beverages {
            background: rgba(155, 89, 182, 0.1) !important;
            border-left: 4px solid var(--accent) !important;
        }

        /* ===== CONTACT US STYLES ===== */
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        @media (min-width: 768px) {
            .contact-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .contact-info-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all var(--transition-normal);
        }

        .contact-info-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 1.5rem;
        }

        .contact-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .contact-card-text {
            color: var(--gray-600);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .contact-card-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-fast);
        }

        .contact-card-link:hover {
            color: var(--primary-dark);
            transform: translateX(4px);
        }

        .business-hours {
            background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%);
            border-radius: var(--radius-lg);
            padding: 2rem;
            color: white;
            margin: 2rem 0;
        }

        .hours-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .hours-grid {
            display: grid;
            gap: 1rem;
        }

        .hours-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hours-row:last-child {
            border-bottom: none;
        }

        .hours-day {
            font-weight: 600;
        }

        .hours-time {
            opacity: 0.9;
        }

        /* ===== FAVORITES PAGE ===== */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* ===== MY ORDERS PAGE ===== */
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .order-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            transition: all var(--transition-normal);
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-id {
            font-weight: 700;
            color: var(--dark);
            font-size: 1.125rem;
        }

        .order-date {
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .order-status {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .status-processing {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }

        .status-completed {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success);
        }

        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .order-items {
            margin-top: 1rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--gray-200);
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--dark);
        }

        /* ===== UTILITIES ===== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
    </style>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Animation -->
    <div class="loading-screen" id="loadingScreen">
        <div class="logo-animation">
            <div class="company-logo">
                <i class="fas fa-shopping-basket" style="color: white; font-size: 3rem;"></i>
            </div>
            <div class="line-animation">
                <div class="line line-1"></div>
                <div class="line line-2"></div>
                <div class="line line-3"></div>
                <div class="line line-4"></div>
            </div>
        </div>
        <div class="loading-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="modal-close" id="authModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Login</button>
                <button class="auth-tab" id="registerTab">Register</button>
            </div>
            <div class="auth-body">
                <div id="loginForm">
                    <h2 class="auth-title">Login to Your Account</h2>
                    <div id="authMessage" class="auth-message hidden"></div>
                    <form class="auth-form" id="loginFormElement">
                        <div class="form-group">
                            <label class="form-label">Email or Phone Number</label>
                            <input type="text" class="form-input" placeholder="email@example.com or +9601234567" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" placeholder="Enter your password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i>
                            Login
                        </button>
                    </form>
                    <p class="text-center mt-3" style="color: var(--gray-500);">
                        Don't have an account? <a href="#" id="switchToRegister" style="color: var(--primary); font-weight: 600; text-decoration: none;">Register here</a>
                    </p>
                </div>
                <div id="registerForm" style="display: none;">
                    <h2 class="auth-title">Create Account</h2>
                    <div id="registerMessage" class="auth-message hidden"></div>
                    <form class="auth-form" id="registerFormElement">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" placeholder="John Doe" id="registerName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" placeholder="email@example.com" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" placeholder="+9601234567" id="registerPhone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" placeholder="Create a password (min. 6 characters)" id="registerPassword" minlength="6" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-input" placeholder="Confirm your password" id="registerConfirmPassword" minlength="6" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i>
                            Create Account
                        </button>
                    </form>
                    <p class="text-center mt-3" style="color: var(--gray-500);">
                        Already have an account? <a href="#" id="switchToLogin" style="color: var(--primary); font-weight: 600; text-decoration: none;">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div class="product-modal" id="productModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </button>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Bank Transfer Modal -->
    <div class="bank-transfer-modal" id="bankTransferModal">
        <div class="bank-transfer-content">
            <button class="modal-close" id="bankModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="bank-details">
                <h2 class="bank-details-title">Bank Transfer Details</h2>
                
                <!-- Order Summary Box -->
                <div class="order-summary-box" id="orderSummaryBox">
                    <div class="summary-amount">
                        <div class="amount-label">Total Amount to Pay</div>
                        <div class="amount-value" id="amountValue">0.00</div>
                        <div class="amount-currency">Maldives Rufiyaa (MVR)</div>
                    </div>
                    <div class="summary-note">
                        Please transfer the exact amount shown above
                    </div>
                </div>
                
                <!-- Bank Information -->
                <div class="bank-info">
                    <div class="bank-info-item">
                        <span class="bank-label">Account Name:</span>
                        <span class="bank-value">Aleela Trade</span>
                    </div>
                    <div class="bank-info-item">
                        <span class="bank-label">Account Number:</span>
                        <span class="bank-value">
                            <span id="accountNumber">7712440335001</span>
                            <button class="copy-btn" id="copyAccountBtn">
                                <i class="fas fa-copy"></i>
                                Copy
                            </button>
                        </span>
                    </div>
                    <div class="bank-info-item">
                        <span class="bank-label">Bank Name:</span>
                        <span class="bank-value">Bank of Maldives</span>
                    </div>
                    <div class="bank-info-item">
                        <span class="bank-label">SWIFT Code:</span>
                        <span class="bank-value">
                            <span id="swiftCode">BMLFMVMV</span>
                            <button class="copy-btn" id="copySwiftBtn">
                                <i class="fas fa-copy"></i>
                                Copy
                            </button>
                        </span>
                    </div>
                    <div class="bank-info-item">
                        <span class="bank-label">Currency:</span>
                        <span class="bank-value">Maldives Rufiyaa (MVR)</span>
                    </div>
                </div>
                
                <!-- Important Notes -->
                <div style="background: rgba(243, 156, 18, 0.1); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                        <i class="fas fa-exclamation-circle" style="color: var(--warning); font-size: 1.25rem; flex-shrink: 0;"></i>
                        <div>
                            <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.25rem;">Important Notes:</div>
                            <div style="font-size: 0.875rem; color: var(--gray-700); line-height: 1.4;">
                                1. Transfer the exact amount shown above<br>
                                2. Include your order number in the transfer description<br>
                                3. Complete payment within 24 hours<br>
                                4. Upload your payment receipt below
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Receipt Upload Section -->
                <div class="upload-receipt">
                    <label class="upload-label">Upload Payment Receipt</label>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload receipt</p>
                        <small>JPG, PNG or PDF (Max 5MB)</small>
                        <input type="file" id="receiptFile" accept=".jpg,.jpeg,.png,.pdf" hidden>
                    </div>
                    
                    <div class="file-preview" id="filePreview">
                        <i class="fas fa-file-invoice"></i>
                        <div class="file-info">
                            <div class="file-name" id="fileName"></div>
                            <div class="file-size" id="fileSize"></div>
                        </div>
                        <button class="remove-file" id="removeFile">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="modal-actions">
                    <button class="btn btn-primary" id="confirmPaymentBtn">
                        <i class="fas fa-check"></i>
                        Confirm Payment
                    </button>
                    <button class="btn btn-outline" id="cancelPaymentBtn">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="map-modal" id="mapModal">
        <div class="map-content">
            <button class="modal-close" id="mapModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div id="map"></div>
            <div class="map-info">
                <h3 class="map-title">Aleela Trade Store Locations</h3>
                <p>Visit our stores or get directions:</p>
                <div class="map-actions">
                    <button class="btn btn-primary" id="getDirectionsBtn">
                        <i class="fas fa-directions"></i>
                        Get Directions
                    </button>
                    <button class="btn btn-outline" id="closeMapBtn">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <a href="#" class="brand" data-page="home">
                    <div class="brand-logo">
                        <i class="fas fa-shopping-basket"></i>
                    </div>
                    <div class="brand-text">Aleela Trade</div>
                </a>
                
                <div class="header-actions">
                    <button class="action-btn" id="favoritesBtn">
                        <i class="fas fa-heart"></i>
                        <span class="favorites-badge" id="favoritesBadge">0</span>
                    </button>
                    <button class="action-btn" id="cartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge" id="cartBadge">0</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <nav id="mobileNav">
            <!-- Search in Sidebar -->
            <div style="margin-bottom: 1.5rem;">
                <div style="position: relative;">
                    <input type="text" 
                           style="width: 100%; padding: 0.875rem 1rem 0.875rem 3rem; border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem; background: var(--gray-100);"
                           placeholder="Search groceries..." 
                           id="sidebarSearch">
                    <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray-400);"></i>
                </div>
            </div>
            
            <!-- User Profile Section in Sidebar -->
            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gray-100); border-radius: var(--radius-md); margin-bottom: 1.5rem;" id="sidebarUserProfile">
                <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.25rem;" id="sidebarUserAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--dark);" id="sidebarUserName">Guest User</div>
                    <div style="font-size: 0.875rem; color: var(--gray-500);" id="sidebarUserEmail">Login to access account</div>
                </div>
            </div>
            
            <!-- Categories -->
            <div class="nav-categories">
                <button class="category-btn" data-category="all">
                    <span>All Products</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="fruits">
                    <span>Fresh Fruits</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="vegetables">
                    <span>Fresh Vegetables</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="dairy">
                    <span>Dairy & Eggs</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="meat">
                    <span>Meat & Poultry</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="bakery">
                    <span>Bakery</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="category-btn" data-category="beverages">
                    <span>Beverages</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Navigation Links -->
            <div class="nav-links">
                <a href="#" class="nav-link" data-page="home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-link" data-page="products">
                    <i class="fas fa-store"></i>
                    <span>All Products</span>
                </a>
                <a href="#" class="nav-link" data-page="sale">
                    <i class="fas fa-tag"></i>
                    <span>Weekly Specials</span>
                </a>
                <a href="#" class="nav-link" id="sidebarFavoritesLink" data-page="favorites">
                    <i class="fas fa-heart"></i>
                    <span>My Favorites</span>
                </a>
                <a href="#" class="nav-link" id="sidebarStoreLocationsLink">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Store Locations</span>
                </a>
                <a href="#" class="nav-link" id="sidebarMyOrdersLink" data-page="orders">
                    <i class="fas fa-shopping-bag"></i>
                    <span>My Orders</span>
                </a>
                <a href="#" class="nav-link" id="sidebarAccountLink">
                    <i class="fas fa-user"></i>
                    <span>My Account</span>
                </a>
                <a href="#" class="nav-link" data-page="contact">
                    <i class="fas fa-phone"></i>
                    <span>Contact Us</span>
                </a>
                <a href="#" class="nav-link" id="sidebarLogoutLink" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
                <a href="#" class="nav-link" id="sidebarLoginLink">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login / Register</span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container" id="mainContent">
        <!-- Content will be dynamically loaded here -->
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Aleela Trade</h3>
                    <ul class="footer-links">
                        <li><a href="#" id="aboutUsLink">About Us</a></li>
                        <li><a href="#" id="footerStoreLink">Store Locations</a></li>
                        <li><a href="#" id="contactUsFooter">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul class="footer-links">
                        <li><a href="#" data-page="contact">Contact Us</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Delivery Info</a></li>
                        <li><a href="#">Returns & Refunds</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <ul class="footer-links">
                        <li>Aleela Trade, Male' City</li>
                        <li>+960 7468757</li>
                        <li>info@aleelatrade.com.mv</li>
                        <li>Open Daily: 7:00 AM - 11:00 PM</li>
                    </ul>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; <span id="currentYear"></span> Aleela Trade. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
       // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyARF48_dYIO4e9aBZguW0Bru7_BvcqGJm0",
  authDomain: "aleelatrade-31ebf.firebaseapp.com",
  databaseURL: "https://aleelatrade-31ebf-default-rtdb.firebaseio.com",
  projectId: "aleelatrade-31ebf",
  storageBucket: "aleelatrade-31ebf.firebasestorage.app",
  messagingSenderId: "902208155198",
  appId: "1:902208155198:web:35ea4005bdee7a8c57eb6f",
  measurementId: "G-2YY9NV98HM"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // ===== APP STATE =====
        let state = {
            cart: JSON.parse(localStorage.getItem('cart')) || {},
            favorites: JSON.parse(localStorage.getItem('favorites')) || [],
            currentPage: 'home',
            currentCategory: null,
            currentSearch: '',
            currentProduct: null,
            products: [],
            categories: [
                { id: 'all', name: 'All Products', icon: 'fas fa-boxes' },
                { id: 'fruits', name: 'Fresh Fruits', icon: 'fas fa-apple-alt' },
                { id: 'vegetables', name: 'Vegetables', icon: 'fas fa-carrot' },
                { id: 'dairy', name: 'Dairy & Eggs', icon: 'fas fa-egg' },
                { id: 'meat', name: 'Meat & Poultry', icon: 'fas fa-drumstick-bite' },
                { id: 'bakery', name: 'Bakery', icon: 'fas fa-bread-slice' },
                { id: 'beverages', name: 'Beverages', icon: 'fas fa-wine-bottle' }
            ],
            sliderImages: [],
            deliverySettings: {},
            currentUser: null,
            userData: null,
            currentSlide: 0,
            map: null,
            storeLocations: [
                {
                    name: "Aleela Trade Main Store",
                    address: "Majeedhee Magu, Male' City, Maldives",
                    lat: 4.1755,
                    lng: 73.5093,
                    phone: "+960 333 6699",
                    hours: "7:00 AM - 11:00 PM",
                    googleMapsUrl: "https://maps.app.goo.gl/LZHMVCEQ6p62apws6"
                },
                {
                    name: "Aleela Trade Hulhumale' Branch",
                    address: "Hulhumale' Central Market, Maldives",
                    lat: 4.2167,
                    lng: 73.5333,
                    phone: "+960 333 6688",
                    hours: "8:00 AM - 10:00 PM",
                    googleMapsUrl: "https://maps.app.goo.gl/LZHMVCEQ6p62apws6"
                }
            ],
            pendingOrder: null,
            currentOrderTotal: 0
        };

        // ===== DOM ELEMENTS =====
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');
        const menuToggle = document.getElementById('menuToggle');
        const mobileNav = document.getElementById('mobileNav');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const cartBtn = document.getElementById('cartBtn');
        const cartBadge = document.getElementById('cartBadge');
        const favoritesBtn = document.getElementById('favoritesBtn');
        const favoritesBadge = document.getElementById('favoritesBadge');
        const currentYear = document.getElementById('currentYear');
        const productModal = document.getElementById('productModal');
        const modalClose = document.getElementById('modalClose');
        const modalContent = document.getElementById('modalContent');
        const bankTransferModal = document.getElementById('bankTransferModal');
        const bankModalClose = document.getElementById('bankModalClose');
        const copyAccountBtn = document.getElementById('copyAccountBtn');
        const copySwiftBtn = document.getElementById('copySwiftBtn');
        const uploadArea = document.getElementById('uploadArea');
        const receiptFile = document.getElementById('receiptFile');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFile = document.getElementById('removeFile');
        const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
        const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
        const mapModal = document.getElementById('mapModal');
        const mapModalClose = document.getElementById('mapModalClose');
        const closeMapBtn = document.getElementById('closeMapBtn');
        const getDirectionsBtn = document.getElementById('getDirectionsBtn');
        const aboutUsLink = document.getElementById('aboutUsLink');
        const footerStoreLink = document.getElementById('footerStoreLink');
        const contactUsFooter = document.getElementById('contactUsFooter');
        
        // Sidebar elements
        const sidebarSearch = document.getElementById('sidebarSearch');
        const sidebarUserProfile = document.getElementById('sidebarUserProfile');
        const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
        const sidebarUserName = document.getElementById('sidebarUserName');
        const sidebarUserEmail = document.getElementById('sidebarUserEmail');
        const sidebarFavoritesLink = document.getElementById('sidebarFavoritesLink');
        const sidebarStoreLocationsLink = document.getElementById('sidebarStoreLocationsLink');
        const sidebarMyOrdersLink = document.getElementById('sidebarMyOrdersLink');
        const sidebarAccountLink = document.getElementById('sidebarAccountLink');
        const sidebarLogoutLink = document.getElementById('sidebarLogoutLink');
        const sidebarLoginLink = document.getElementById('sidebarLoginLink');
        
        // Auth modal elements
        const authModal = document.getElementById('authModal');
        const authModalClose = document.getElementById('authModalClose');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginFormElement = document.getElementById('loginFormElement');
        const registerFormElement = document.getElementById('registerFormElement');
        const switchToRegister = document.getElementById('switchToRegister');
        const switchToLogin = document.getElementById('switchToLogin');
        const authMessage = document.getElementById('authMessage');
        const registerMessage = document.getElementById('registerMessage');

        // ===== CURRENCY FORMATTER =====
        function formatCurrency(amount) {
            return 'MVR ' + amount.toLocaleString('en-MV', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // ===== INITIALIZATION =====
        function init() {
            // Set current year
            currentYear.textContent = new Date().getFullYear();
            
            // Initialize event listeners
            setupEventListeners();
            
            // Set up auth state listener
            setupAuthListener();
            
            // Hide loading screen after 2 seconds
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                loadAppData();
            }, 2000);
        }

        function setupEventListeners() {
            // Menu toggle
            menuToggle.addEventListener('click', toggleMobileNav);
            
            // Sidebar overlay
            sidebarOverlay.addEventListener('click', closeMobileNav);
            
            // Cart button
            cartBtn.addEventListener('click', () => {
                loadPage('cart');
                closeMobileNav();
            });
            
            // Favorites button
            favoritesBtn.addEventListener('click', () => {
                if (state.currentUser) {
                    loadPage('favorites');
                } else {
                    showAuthModal();
                }
                closeMobileNav();
            });
            
            // Sidebar search
            sidebarSearch.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    state.currentSearch = sidebarSearch.value;
                    state.currentCategory = null;
                    loadPage('products');
                    closeMobileNav();
                }
            });
            
            // Brand logo
            document.querySelector('.brand').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('home');
                closeMobileNav();
            });
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    if (page) {
                        loadPage(page);
                        closeMobileNav();
                    }
                });
            });
            
            // Sidebar links
            sidebarFavoritesLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (state.currentUser) {
                    loadPage('favorites');
                } else {
                    showAuthModal();
                }
                closeMobileNav();
            });
            
            sidebarStoreLocationsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showMapModal();
                closeMobileNav();
            });
            
            sidebarMyOrdersLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (state.currentUser) {
                    loadPage('orders');
                } else {
                    showAuthModal();
                }
                closeMobileNav();
            });
            
            sidebarAccountLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (state.currentUser) {
                    loadPage('account');
                } else {
                    showAuthModal();
                }
                closeMobileNav();
            });
            
            sidebarLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showAuthModal();
                closeMobileNav();
            });
            
            sidebarLogoutLink.addEventListener('click', (e) => {
                e.preventDefault();
                handleLogout();
                closeMobileNav();
            });
            
            // Store locations links
            footerStoreLink.addEventListener('click', (e) => {
                e.preventDefault();
                showMapModal();
            });
            
            aboutUsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showAboutUsModal();
            });
            
            contactUsFooter.addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('contact');
            });
            
            // Category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.dataset.category;
                    state.currentCategory = category === 'all' ? null : category;
                    loadPage('products');
                    closeMobileNav();
                });
            });
            
            // Modal close
            modalClose.addEventListener('click', () => {
                productModal.classList.remove('active');
            });
            
            // Auth modal
            authModalClose.addEventListener('click', () => {
                authModal.classList.remove('active');
            });
            
            // Bank modal close
            bankModalClose.addEventListener('click', () => {
                bankTransferModal.classList.remove('active');
            });
            
            cancelPaymentBtn.addEventListener('click', () => {
                bankTransferModal.classList.remove('active');
            });
            
            // Map modal close
            mapModalClose.addEventListener('click', () => {
                mapModal.classList.remove('active');
            });
            
            closeMapBtn.addEventListener('click', () => {
                mapModal.classList.remove('active');
            });
            
            // Get directions button
            getDirectionsBtn.addEventListener('click', () => {
                window.open('https://maps.app.goo.gl/LZHMVCEQ6p62apws6', '_blank');
            });
            
            // Close modals when clicking outside
            productModal.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    productModal.classList.remove('active');
                }
            });
            
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.classList.remove('active');
                }
            });
            
            bankTransferModal.addEventListener('click', (e) => {
                if (e.target === bankTransferModal) {
                    bankTransferModal.classList.remove('active');
                }
            });
            
            mapModal.addEventListener('click', (e) => {
                if (e.target === mapModal) {
                    mapModal.classList.remove('active');
                }
            });
            
            // Close modals with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    productModal.classList.remove('active');
                    authModal.classList.remove('active');
                    bankTransferModal.classList.remove('active');
                    mapModal.classList.remove('active');
                }
            });
            
            // Copy buttons
            copyAccountBtn.addEventListener('click', () => copyToClipboard('accountNumber', copyAccountBtn));
            copySwiftBtn.addEventListener('click', () => copyToClipboard('swiftCode', copySwiftBtn));
            
            // File upload
            uploadArea.addEventListener('click', () => {
                receiptFile.click();
            });
            
            receiptFile.addEventListener('change', handleFileUpload);
            
            removeFile.addEventListener('click', () => {
                receiptFile.value = '';
                filePreview.style.display = 'none';
                uploadArea.style.display = 'block';
            });
            
            // Confirm payment
            confirmPaymentBtn.addEventListener('click', confirmPayment);
            
            // Auth tabs
            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            });
            
            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.style.display = 'block';
                loginForm.style.display = 'none';
            });
            
            switchToRegister.addEventListener('click', (e) => {
                e.preventDefault();
                registerTab.click();
            });
            
            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                loginTab.click();
            });
            
            // Login form
            loginFormElement.addEventListener('submit', handleLogin);
            
            // Register form
            registerFormElement.addEventListener('submit', handleRegister);
        }

        // ===== AUTH FUNCTIONS =====
        function setupAuthListener() {
            auth.onAuthStateChanged(async (user) => {
                state.currentUser = user;
                
                if (user) {
                    // User is signed in
                    await loadUserData(user.uid);
                    updateUserInterface(true);
                    updateSidebarUserInfo();
                    showNotification(`Welcome back, ${state.userData?.fullName || 'User'}!`);
                } else {
                    // User is signed out
                    state.userData = null;
                    updateUserInterface(false);
                    updateSidebarUserInfo();
                }
            });
        }

        async function loadUserData(userId) {
            try {
                const snapshot = await database.ref(`users/${userId}`).once('value');
                if (snapshot.exists()) {
                    state.userData = snapshot.val();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function updateSidebarUserInfo() {
            if (state.currentUser && state.userData) {
                // User is logged in
                sidebarUserAvatar.innerHTML = state.userData.fullName.charAt(0).toUpperCase();
                sidebarUserName.textContent = state.userData.fullName;
                sidebarUserEmail.textContent = state.userData.email;
                sidebarLoginLink.style.display = 'none';
                sidebarLogoutLink.style.display = 'flex';
            } else {
                // User is not logged in
                sidebarUserAvatar.innerHTML = '<i class="fas fa-user"></i>';
                sidebarUserName.textContent = 'Guest User';
                sidebarUserEmail.textContent = 'Login to access account';
                sidebarLoginLink.style.display = 'flex';
                sidebarLogoutLink.style.display = 'none';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            authMessage.textContent = '';
            authMessage.classList.add('hidden');
            
            try {
                // Check if identifier is email or phone
                let userCredential;
                if (identifier.includes('@')) {
                    // Email login
                    userCredential = await auth.signInWithEmailAndPassword(identifier, password);
                } else {
                    // Phone number login - find user by phone
                    const usersRef = database.ref('users');
                    const snapshot = await usersRef.orderByChild('phone').equalTo(identifier).once('value');
                    
                    if (snapshot.exists()) {
                        const userData = Object.values(snapshot.val())[0];
                        userCredential = await auth.signInWithEmailAndPassword(userData.email, password);
                    } else {
                        throw new Error('Invalid phone number or password');
                    }
                }
                
                // Success
                authModal.classList.remove('active');
                loginFormElement.reset();
            } catch (error) {
                authMessage.textContent = error.message;
                authMessage.classList.remove('hidden');
                authMessage.classList.add('error');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            registerMessage.textContent = '';
            registerMessage.classList.add('hidden');
            
            // Validate passwords match
            if (password !== confirmPassword) {
                registerMessage.textContent = 'Passwords do not match';
                registerMessage.classList.remove('hidden');
                registerMessage.classList.add('error');
                return;
            }
            
            try {
                // Check if email already exists
                const emailCheck = await database.ref('users').orderByChild('email').equalTo(email).once('value');
                if (emailCheck.exists()) {
                    throw new Error('Email already registered');
                }
                
                // Check if phone already exists
                const phoneCheck = await database.ref('users').orderByChild('phone').equalTo(phone).once('value');
                if (phoneCheck.exists()) {
                    throw new Error('Phone number already registered');
                }
                
                // Create user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Save user data to database
                await database.ref(`users/${userCredential.user.uid}`).set({
                    fullName: name,
                    email: email,
                    phone: phone,
                    createdAt: new Date().toISOString(),
                    role: 'customer'
                });
                
                // Success
                authModal.classList.remove('active');
                registerFormElement.reset();
                showNotification('Account created successfully!');
            } catch (error) {
                registerMessage.textContent = error.message;
                registerMessage.classList.remove('hidden');
                registerMessage.classList.add('error');
            }
        }

        function handleLogout() {
            auth.signOut()
                .then(() => {
                    showNotification('Logged out successfully');
                })
                .catch((error) => {
                    showNotification('Error logging out: ' + error.message, 'error');
                });
        }

        function updateUserInterface(isLoggedIn) {
            if (isLoggedIn && state.userData) {
                // User is logged in
                // Update sidebar user info is already handled by updateSidebarUserInfo
            }
        }

        function showAuthModal() {
            authModal.classList.add('active');
            loginTab.click();
            loginFormElement.reset();
            registerFormElement.reset();
            authMessage.classList.add('hidden');
            registerMessage.classList.add('hidden');
        }

        // ===== MAP FUNCTIONS =====
        function initMap() {
            const defaultLocation = { lat: 4.1755, lng: 73.5093 };
            
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: defaultLocation,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true
            });
            
            state.map = map;
            
            state.storeLocations.forEach(location => {
                const marker = new google.maps.Marker({
                    position: { lat: location.lat, lng: location.lng },
                    map: map,
                    title: location.name,
                    animation: google.maps.Animation.DROP
                });
                
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 1rem;">
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--primary);">${location.name}</h3>
                            <p style="margin: 0.25rem 0;">${location.address}</p>
                            <p style="margin: 0.25rem 0;"><strong>Phone:</strong> ${location.phone}</p>
                            <p style="margin: 0.25rem 0;"><strong>Hours:</strong> ${location.hours}</p>
                            <button onclick="window.open('${location.googleMapsUrl}', '_blank')" 
                                    style="background: var(--primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-top: 0.5rem;">
                                Get Directions
                            </button>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
            });
        }

        function showMapModal() {
            mapModal.classList.add('active');
            
            if (!state.map) {
                setTimeout(initMap, 100);
            }
        }

        function showAboutUsModal() {
            modalContent.innerHTML = `
                <div class="modal-body">
                    <h2 class="modal-title">About Aleela Trade</h2>
                    <p style="color: var(--gray-600); line-height: 1.6; margin-bottom: 1.5rem;">
                        Aleela Trade is your trusted partner for fresh groceries in the Maldives. 
                        We bring you the finest selection of fruits, vegetables, dairy, meat, and 
                        bakery items directly from farms to your doorstep.
                    </p>
                    
                    <div style="background: var(--gray-100); border-radius: var(--radius-md); padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: var(--dark);">Our Mission</h3>
                        <p style="color: var(--gray-600); line-height: 1.6;">
                            To provide fresh, high-quality groceries with convenient home delivery, 
                            making healthy eating accessible to everyone in the Maldives.
                        </p>
                    </div>
                    
                    <div style="background: var(--gray-100); border-radius: var(--radius-md); padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: var(--dark);">Store Locations</h3>
                        <button class="btn btn-primary" onclick="showMapModal(); productModal.classList.remove('active');" style="width: 100%;">
                            <i class="fas fa-map-marker-alt"></i>
                            View Store Locations
                        </button>
                    </div>
                </div>
            `;
            
            productModal.classList.add('active');
        }

        // ===== SLIDER FUNCTIONS =====
        function renderImageSlider() {
            if (!state.sliderImages || state.sliderImages.length === 0) {
                return '';
            }
            
            return `
                <div class="slider-container">
                    <div class="slider" id="imageSlider">
                        ${state.sliderImages.map((slide, index) => `
                            <div class="slide">
                                <img src="${slide.image}" alt="${slide.title}" onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=1200&fit=crop'">
                                <div class="slide-content">
                                    <h2>${slide.title}</h2>
                                    <p>${slide.description}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="slider-dots" id="sliderDots">
                        ${state.sliderImages.map((_, index) => `
                            <button class="slider-dot ${index === 0 ? 'active' : ''}" data-slide="${index}"></button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function initializeSlider() {
            const slider = document.querySelector('.slider');
            const dots = document.querySelectorAll('.slider-dot');
            if (!slider || !dots.length) return;
            
            let currentSlide = 0;
            const totalSlides = state.sliderImages.length;
            
            function updateSlider() {
                if (slider) {
                    slider.style.transform = `translateX(-${currentSlide * 100}%)`;
                    
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentSlide);
                    });
                }
            }
            
            let slideInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % totalSlides;
                updateSlider();
            }, 5000);
            
            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    clearInterval(slideInterval);
                    currentSlide = parseInt(dot.dataset.slide);
                    updateSlider();
                    
                    slideInterval = setInterval(() => {
                        currentSlide = (currentSlide + 1) % totalSlides;
                        updateSlider();
                    }, 5000);
                });
            });
            
            updateSlider();
        }

        // ===== SIDEBAR ANIMATION FUNCTIONS =====
        function toggleMobileNav() {
            const isActive = menuToggle.classList.toggle('active');
            
            if (isActive) {
                openMobileNav();
            } else {
                closeMobileNav();
            }
        }

        function openMobileNav() {
            sidebarOverlay.classList.add('active');
            mobileNav.classList.add('active');
            
            const bars = menuToggle.querySelectorAll('span');
            bars[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            bars[1].style.opacity = '0';
            bars[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
            
            const categoryBtns = document.querySelectorAll('.category-btn');
            const navLinks = document.querySelectorAll('.nav-link');
            
            categoryBtns.forEach((btn, index) => {
                setTimeout(() => {
                    btn.style.opacity = '1';
                    btn.style.transform = 'translateX(0)';
                }, 100 + (index * 50));
            });
            
            navLinks.forEach((link, index) => {
                setTimeout(() => {
                    link.style.opacity = '1';
                    link.style.transform = 'translateX(0)';
                }, 300 + (index * 50));
            });
        }

        function closeMobileNav() {
            const bars = menuToggle.querySelectorAll('span');
            bars[0].style.transform = 'none';
            bars[1].style.opacity = '1';
            bars[2].style.transform = 'none';
            
            sidebarOverlay.classList.remove('active');
            
            const categoryBtns = document.querySelectorAll('.category-btn');
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach((link, index) => {
                setTimeout(() => {
                    link.style.opacity = '0';
                    link.style.transform = 'translateX(-20px)';
                }, (navLinks.length - 1 - index) * 30);
            });
            
            categoryBtns.forEach((btn, index) => {
                setTimeout(() => {
                    btn.style.opacity = '0';
                    btn.style.transform = 'translateX(-20px)';
                }, 100 + ((categoryBtns.length - 1 - index) * 30));
            });
            
            setTimeout(() => {
                mobileNav.classList.remove('active');
            }, 400);
        }

        // ===== APP DATA LOADING =====
        function loadAppData() {
            // Load delivery settings
            database.ref('settings/delivery').on('value', (snapshot) => {
                state.deliverySettings = snapshot.val() || {
                    minOrder: 100,
                    deliveryFee: 150,
                    freeDeliveryThreshold: 1500
                };
            });
            
            // Load slider images
            database.ref('slider').on('value', (snapshot) => {
                const sliderData = snapshot.val();
                if (sliderData) {
                    state.sliderImages = Object.values(sliderData);
                } else {
                    // Default slider images
                    state.sliderImages = [
                        {
                            image: 'https://images.unsplash.com/photo-1542838132-92c53300491e?w=1200&fit=crop',
                            title: 'Fresh Produce Daily',
                            description: 'Farm-fresh fruits and vegetables'
                        },
                        {
                            image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=1200&fit=crop',
                            title: 'Weekly Specials',
                            description: 'Up to 30% off on selected items'
                        },
                        {
                            image: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=1200&fit=crop',
                            title: 'Organic Selection',
                            description: 'Healthy organic options available'
                        }
                    ];
                }
                
                if (state.currentPage === 'home') {
                    renderHomePage();
                }
            });
            
            // Load products
            database.ref('products').on('value', (snapshot) => {
                const productsData = snapshot.val();
                if (productsData) {
                    state.products = Object.keys(productsData).map(key => {
                        return { id: key, ...productsData[key] };
                    });
                    
                    if (state.products.length === 0) {
                        addSampleProducts();
                    } else {
                        updateCartCount();
                        updateFavoritesCount();
                        if (state.currentPage) {
                            loadPage(state.currentPage);
                        }
                    }
                } else {
                    addSampleProducts();
                }
            });
        }

        function addSampleProducts() {
            const sampleProducts = [
                {
                    name: 'Fresh Apples - 1kg',
                    price: 45.99,
                    original_price: 49.99,
                    image: 'https://images.unsplash.com/photo-1568702846914-96b305d2aaeb?w=400&h=300&fit=crop',
                    description: 'Fresh imported red apples, sweet and crisp.',
                    category: 'fruits',
                    featured: true,
                    stock: 50,
                    specifications: {
                        'Type': 'Red Delicious',
                        'Origin': 'New Zealand',
                        'Weight': '1kg',
                        'Storage': 'Refrigerate'
                    }
                },
                {
                    name: 'Organic Bananas - Bunch',
                    price: 25.99,
                    original_price: 29.99,
                    image: 'https://images.unsplash.com/photo-1603833665858-e61d17a86224?w=400&h=300&fit=crop',
                    description: 'Organic ripe bananas, perfect for smoothies.',
                    category: 'fruits',
                    featured: true,
                    stock: 100,
                    specifications: {
                        'Type': 'Cavendish',
                        'Origin': 'Philippines',
                        'Certification': 'Organic',
                        'Ripeness': 'Ready to eat'
                    }
                },
                {
                    name: 'Fresh Milk - 1L',
                    price: 35.99,
                    original_price: 39.99,
                    image: 'https://images.unsplash.com/photo-1563636619-e9143da7973b?w=400&h=300&fit=crop',
                    description: 'Fresh whole milk, pasteurized and homogenized.',
                    category: 'dairy',
                    featured: true,
                    stock: 75,
                    specifications: {
                        'Brand': 'Farm Fresh',
                        'Type': 'Whole Milk',
                        'Volume': '1 Liter',
                        'Fat Content': '3.5%'
                    }
                },
                {
                    name: 'Fresh Eggs - 12 Pieces',
                    price: 28.99,
                    original_price: 32.99,
                    image: 'https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=400&h=300&fit=crop',
                    description: 'Farm fresh eggs, large size.',
                    category: 'dairy',
                    featured: true,
                    stock: 200,
                    specifications: {
                        'Size': 'Large',
                        'Quantity': '12 pieces',
                        'Type': 'Grade A',
                        'Farm': 'Free-range'
                    }
                }
            ];

            sampleProducts.forEach(product => {
                database.ref('products').push(product);
            });
        }

        // ===== FAVORITES SYSTEM =====
        function toggleFavorite(productId) {
            if (!state.currentUser) {
                showAuthModal();
                return;
            }
            
            const index = state.favorites.indexOf(productId);
            if (index === -1) {
                state.favorites.push(productId);
            } else {
                state.favorites.splice(index, 1);
            }
            
            localStorage.setItem('favorites', JSON.stringify(state.favorites));
            updateFavoritesCount();
            
            if (state.currentPage === 'favorites') {
                renderFavoritesPage();
            }
            
            showNotification(index === -1 ? 'Added to favorites' : 'Removed from favorites');
        }

        function isFavorite(productId) {
            return state.favorites.includes(productId);
        }

        function updateFavoritesCount() {
            const count = state.favorites.length;
            favoritesBadge.textContent = count;
            favoritesBadge.style.display = count > 0 ? 'flex' : 'none';
        }

        // ===== PRODUCT DETAILS MODAL =====
        function showProductDetails(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;

            modalContent.innerHTML = `
                <div class="modal-image">
                    <img src="${product.image}" alt="${product.name}" onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=400&fit=crop'">
                </div>
                <div class="modal-body">
                    <h2 class="modal-title">${product.name}</h2>
                    
                    <div class="modal-price">
                        <span class="current-price">${formatCurrency(product.price)}</span>
                        ${product.original_price > product.price ? 
                            `<span class="original-price">${formatCurrency(product.original_price)}</span>` : ''}
                    </div>
                    
                    <div class="stock-status ${getStockClass(product.stock)}">
                        <i class="fas ${getStockIcon(product.stock)}"></i>
                        <span>${getStockText(product.stock)}</span>
                    </div>
                    
                    <div class="modal-description">
                        ${product.description}
                    </div>
                    
                    ${product.specifications ? `
                        <div class="modal-specs">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--dark);">Product Details</h3>
                            ${Object.entries(product.specifications).map(([key, value]) => `
                                <div class="spec-item">
                                    <span class="spec-label">${key}</span>
                                    <span class="spec-value">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="addToCart('${product.id}', 1); productModal.classList.remove('active');">
                            <i class="fas fa-cart-plus"></i>
                            Add to Cart
                        </button>
                        <button class="btn ${isFavorite(product.id) ? 'btn-danger' : 'btn-outline'}" onclick="toggleFavorite('${product.id}'); showProductDetails('${product.id}');">
                            <i class="fas ${isFavorite(product.id) ? 'fa-heart' : 'fa-heart'}"></i>
                            ${isFavorite(product.id) ? 'Remove Favorite' : 'Add to Favorites'}
                        </button>
                    </div>
                </div>
            `;
            
            productModal.classList.add('active');
        }

        // ===== BANK TRANSFER FUNCTIONS =====
        function generateOrderId() {
            return 'AL' + Date.now().toString().slice(-8);
        }

        function showBankTransferModal(orderId, orderTotal) {
            if (!state.currentUser) {
                showAuthModal();
                return null;
            }
            
            // Reset file upload
            receiptFile.value = '';
            filePreview.style.display = 'none';
            uploadArea.style.display = 'block';
            
            // Reset copy buttons
            copyAccountBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
            copyAccountBtn.classList.remove('copied');
            copySwiftBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
            copySwiftBtn.classList.remove('copied');
            
            // Set order total
            state.currentOrderTotal = orderTotal;
            document.getElementById('amountValue').textContent = orderTotal.toFixed(2);
            
            bankTransferModal.classList.add('active');
            
            return orderId;
        }

        function copyToClipboard(elementId, button) {
            const text = document.getElementById(elementId).textContent;
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i> Copy';
                        button.classList.remove('copied');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('Failed to copy. Please copy manually.');
                });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('File size exceeds 5MB limit. Please choose a smaller file.');
                receiptFile.value = '';
                return;
            }
            
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            if (!validTypes.includes(file.type)) {
                alert('Invalid file type. Please upload JPG, PNG, or PDF files only.');
                receiptFile.value = '';
                return;
            }
            
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            filePreview.style.display = 'flex';
            uploadArea.style.display = 'none';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function confirmPayment() {
            if (!state.currentUser) {
                showAuthModal();
                return;
            }
            
            if (!receiptFile.files[0]) {
                alert('Please upload your payment receipt before confirming.');
                return;
            }
            
            const order = state.pendingOrder;
            const orderId = generateOrderId();
            
            try {
                await database.ref('orders').push({
                    ...order,
                    orderId: orderId,
                    userId: state.currentUser.uid,
                    customer: {
                        ...order.customer,
                        name: state.userData.fullName,
                        phone: state.userData.phone,
                        email: state.userData.email
                    },
                    paymentStatus: 'pending_review',
                    paymentMethod: 'bank_transfer',
                    bankTransfer: {
                        accountNumber: '7712440335001',
                        accountName: 'Aleela Trade',
                        bankName: 'Bank of Maldives',
                        swiftCode: 'BMLFMVMV',
                        amount: state.currentOrderTotal,
                        receiptUploaded: true,
                        receiptFileName: receiptFile.files[0].name,
                        receiptFileSize: receiptFile.files[0].size,
                        receiptFileType: receiptFile.files[0].type,
                        uploadedAt: new Date().toISOString()
                    },
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                // Clear cart
                state.cart = {};
                localStorage.removeItem('cart');
                updateCartCount();
                
                // Set order details for confirmation page
                state.orderDetails = { ...order, id: orderId, orderId: orderId };
                bankTransferModal.classList.remove('active');
                loadPage('order-confirmation');
                showNotification('Order placed successfully! Payment is under review.');
            } catch (error) {
                alert('Error placing order: ' + error.message);
            }
        }

        // ===== PAGE MANAGEMENT =====
        function loadPage(page) {
            state.currentPage = page;
            
            switch(page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'products':
                    renderProductsPage();
                    break;
                case 'cart':
                    renderCartPage();
                    break;
                case 'checkout':
                    if (!state.currentUser) {
                        showAuthModal();
                        return;
                    }
                    renderCheckoutPage();
                    break;
                case 'order-confirmation':
                    renderOrderConfirmation();
                    break;
                case 'orders':
                    if (!state.currentUser) {
                        showAuthModal();
                        return;
                    }
                    renderOrdersPage();
                    break;
                case 'sale':
                    renderSalePage();
                    break;
                case 'account':
                    if (!state.currentUser) {
                        showAuthModal();
                        return;
                    }
                    renderAccountPage();
                    break;
                case 'favorites':
                    if (!state.currentUser) {
                        showAuthModal();
                        return;
                    }
                    renderFavoritesPage();
                    break;
                case 'contact':
                    renderContactPage();
                    break;
                default:
                    renderHomePage();
            }
            
            updateActiveNav();
        }

        function renderHomePage() {
            const featuredProducts = state.products.filter(product => product.featured);
            
            mainContent.innerHTML = `
                ${renderImageSlider()}
                
                <div class="page-header">
                    <h1>Fresh Groceries Delivered</h1>
                    <p>Your trusted source for fresh fruits, vegetables, and groceries</p>
                </div>
                
                <!-- Search bar removed from header - now in sidebar -->
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 2rem;">
                    ${state.categories.slice(0, 6).map(cat => `
                        <button class="category-btn" data-category="${cat.id}" style="flex-direction: column; height: auto; padding: 0.75rem 0.25rem;">
                            <i class="${cat.icon}" style="font-size: 1.25rem; margin-bottom: 0.25rem;"></i>
                            <span style="font-size: 0.7rem;">${cat.name}</span>
                        </button>
                    `).join('')}
                </div>
                
                <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--dark);">Featured Products</h2>
                
                <div class="products-grid">
                    ${renderProductCards(featuredProducts.slice(0, 6))}
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-primary" data-page="products">
                        View All Products
                    </button>
                </div>
                
                <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--organic) 100%); border-radius: var(--radius-lg); padding: 1.5rem; color: white; margin-top: 3rem;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div style="text-align: center;">
                            <i class="fas fa-truck" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                            <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Free Delivery</h3>
                            <p style="font-size: 0.75rem; opacity: 0.9;">On orders over MVR ${state.deliverySettings.freeDeliveryThreshold || 1500}</p>
                        </div>
                        <div style="text-align: center;">
                            <i class="fas fa-leaf" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                            <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Fresh Daily</h3>
                            <p style="font-size: 0.75rem; opacity: 0.9;">Farm-to-table produce</p>
                        </div>
                        <div style="text-align: center;">
                            <i class="fas fa-clock" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                            <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Same Day Delivery</h3>
                            <p style="font-size: 0.75rem; opacity: 0.9;">Order by 3 PM</p>
                        </div>
                        <div style="text-align: center;">
                            <i class="fas fa-undo" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                            <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Easy Returns</h3>
                            <p style="font-size: 0.75rem; opacity: 0.9;">24-hour return policy</p>
                        </div>
                    </div>
                </div>
            `;
            
            initializeSlider();
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const category = btn.dataset.category;
                    state.currentCategory = category === 'all' ? null : category;
                    loadPage('products');
                });
            });
            
            document.querySelector('[data-page="products"]').addEventListener('click', (e) => {
                e.preventDefault();
                loadPage('products');
            });
        }

        function renderProductCards(products) {
            return products.map(product => {
                const categoryClass = `category-${product.category}`;
                const isFav = isFavorite(product.id);
                return `
                <div class="product-card" data-id="${product.id}">
                    ${product.original_price > product.price ? 
                        '<div class="product-badge">SALE</div>' : ''}
                    
                    <button class="favorite-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite('${product.id}')">
                        <i class="fas ${isFav ? 'fa-heart' : 'fa-heart'}"></i>
                    </button>
                    
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}" onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=400&fit=crop'">
                    </div>
                    
                    <div class="product-content">
                        <h3 class="product-title">${product.name}</h3>
                        
                        <p class="product-description">${product.description}</p>
                        
                        <div class="product-price">
                            <span class="current-price">${formatCurrency(product.price)}</span>
                            ${product.original_price > product.price ? 
                                `<span class="original-price">${formatCurrency(product.original_price)}</span>` : ''}
                        </div>
                        
                        <div class="stock-status ${getStockClass(product.stock)} ${categoryClass}">
                            <i class="fas ${getStockIcon(product.stock)}"></i>
                            <span>${getStockText(product.stock)}</span>
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-primary" style="font-size: 0.875rem; padding: 0.5rem 0.75rem;" onclick="addToCart('${product.id}', 1)">
                                <i class="fas fa-cart-plus"></i>
                                Add
                            </button>
                            <button class="btn btn-secondary" style="width: 36px; height: 36px;" onclick="showProductDetails('${product.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function renderProductsPage() {
            let filteredProducts = [...state.products];
            
            // Apply category filter
            if (state.currentCategory) {
                filteredProducts = filteredProducts.filter(product => product.category === state.currentCategory);
            }
            
            // Apply search filter
            if (state.currentSearch) {
                const searchTerm = state.currentSearch.toLowerCase();
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm)
                );
            }
            
            // Get category name
            let categoryName = 'All Products';
            if (state.currentCategory) {
                const category = state.categories.find(c => c.id === state.currentCategory);
                categoryName = category ? category.name : state.currentCategory;
            }
            
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>${categoryName}</h1>
                    <p>${filteredProducts.length} product${filteredProducts.length !== 1 ? 's' : ''} found</p>
                </div>
                
                ${filteredProducts.length > 0 ? `
                    <div class="products-grid">
                        ${renderProductCards(filteredProducts)}
                    </div>
                ` : `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>No products found</h3>
                        <p>Try adjusting your search or category filter</p>
                        <button class="btn btn-primary" onclick="state.currentCategory = null; state.currentSearch = ''; loadPage('products');">
                            <i class="fas fa-store"></i>
                            View All Products
                        </button>
                    </div>
                `}
            `;
        }

        function renderFavoritesPage() {
            const favoriteProducts = state.products.filter(product => 
                state.favorites.includes(product.id)
            );
            
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>My Favorites</h1>
                    <p>${favoriteProducts.length} saved item${favoriteProducts.length !== 1 ? 's' : ''}</p>
                </div>
                
                ${favoriteProducts.length > 0 ? `
                    <div class="products-grid">
                        ${renderProductCards(favoriteProducts)}
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn btn-outline" onclick="clearAllFavorites()">
                            <i class="fas fa-trash"></i>
                            Clear All Favorites
                        </button>
                    </div>
                ` : `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3>No favorites yet</h3>
                        <p>Start adding your favorite products by clicking the heart icon</p>
                        <button class="btn btn-primary" onclick="loadPage('products')">
                            <i class="fas fa-store"></i>
                            Browse Products
                        </button>
                    </div>
                `}
            `;
        }

        function clearAllFavorites() {
            if (confirm('Are you sure you want to remove all items from favorites?')) {
                state.favorites = [];
                localStorage.setItem('favorites', JSON.stringify(state.favorites));
                updateFavoritesCount();
                renderFavoritesPage();
                showNotification('All favorites cleared');
            }
        }

        function renderCartPage() {
            const cartItems = Object.keys(state.cart).map(productId => {
                const product = state.products.find(p => p.id === productId);
                return product ? { ...product, quantity: state.cart[productId] } : null;
            }).filter(item => item !== null);
            
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > (state.deliverySettings.freeDeliveryThreshold || 1500) ? 0 : (state.deliverySettings.deliveryFee || 150);
            const tax = subtotal * 0.06;
            const total = subtotal + shipping + tax;
            
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>Shopping Cart</h1>
                    <p>${cartItems.length} item${cartItems.length !== 1 ? 's' : ''} in cart</p>
                </div>
                
                ${cartItems.length > 0 ? `
                    <div class="cart-container">
                        <div class="cart-items">
                            ${cartItems.map(item => `
                                <div class="cart-item">
                                    <img src="${item.image}" alt="${item.name}" class="cart-item-image" onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=400&fit=crop'">
                                    
                                    <div class="cart-item-details">
                                        <h4 class="cart-item-title">${item.name}</h4>
                                        <div class="cart-item-price">${formatCurrency(item.price)}</div>
                                        
                                        <div class="cart-item-controls">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                                                   onchange="updateQuantity('${item.id}', this.value)">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div style="text-align: right;">
                                        <div style="font-weight: 700; font-size: 1.125rem; color: var(--dark);">
                                            ${formatCurrency(item.price * item.quantity)}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Desktop Summary -->
                        <div class="order-summary cart-summary-desktop">
                            <h3 class="summary-title">Order Summary</h3>
                            
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span>${formatCurrency(subtotal)}</span>
                            </div>
                            
                            <div class="summary-row">
                                <span>Delivery</span>
                                <span>${shipping === 0 ? 'FREE' : formatCurrency(shipping)}</span>
                            </div>
                            
                            <div class="summary-row">
                                <span>Tax (6%)</span>
                                <span>${formatCurrency(tax)}</span>
                            </div>
                            
                            <div class="summary-row total">
                                <span>Total</span>
                                <span class="value">${formatCurrency(total)}</span>
                            </div>
                            
                            <button class="btn btn-primary checkout-btn" onclick="loadPage('checkout')">
                                <i class="fas fa-lock"></i>
                                Proceed to Checkout
                            </button>
                            
                            <button class="btn btn-outline mt-2" onclick="loadPage('products')" style="width: 100%;">
                                Continue Shopping
                            </button>
                        </div>
                        
                        <!-- Mobile Summary (Sticky Bottom) -->
                        <div class="cart-summary-mobile">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: var(--gray-500);">Total</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">
                                        ${formatCurrency(total)}
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="loadPage('checkout')" style="padding: 0.75rem 1.5rem;">
                                    <i class="fas fa-lock"></i>
                                    Checkout
                                </button>
                            </div>
                            
                            <div style="font-size: 0.75rem; color: var(--gray-500); text-align: center;">
                                ${shipping === 0 ? 'Free delivery applied' : `Delivery: ${formatCurrency(shipping)}`}
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h3>Your cart is empty</h3>
                        <p>Add some groceries to get started</p>
                        <button class="btn btn-primary" onclick="loadPage('products')">
                            Browse Products
                        </button>
                    </div>
                `}
            `;
        }

        function renderCheckoutPage() {
            const cartItems = Object.keys(state.cart).map(productId => {
                const product = state.products.find(p => p.id === productId);
                return product ? { ...product, quantity: state.cart[productId] } : null;
            }).filter(item => item !== null);
            
            if (cartItems.length === 0) {
                loadPage('cart');
                return;
            }
            
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > (state.deliverySettings.freeDeliveryThreshold || 1500) ? 0 : (state.deliverySettings.deliveryFee || 150);
            const tax = subtotal * 0.06;
            const total = subtotal + shipping + tax;
            
            const minOrder = state.deliverySettings.minOrder || 100;
            const canCheckout = total >= minOrder;
            
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>Checkout</h1>
                    <p>Complete your grocery order</p>
                </div>
                
                ${!canCheckout ? `
                    <div class="empty-state">
                        <div class="empty-icon" style="background: linear-gradient(135deg, var(--warning) 0%, #f39c12 100%);">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <h3>Minimum Order Requirement</h3>
                        <p>Orders must be at least MVR ${minOrder}.00 to proceed with checkout.</p>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin: 1rem 0;">
                            Current Total: ${formatCurrency(total)}
                        </p>
                        <button class="btn btn-primary" onclick="loadPage('products')">
                            <i class="fas fa-shopping-bag"></i>
                            Continue Shopping
                        </button>
                    </div>
                ` : `
                <div class="checkout-container">
                    <div>
                        <div class="checkout-section">
                            <h3 class="section-title">Delivery Information</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-input" value="${state.userData?.fullName || ''}" placeholder="John Doe" id="fullName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number *</label>
                                <input type="tel" class="form-input" value="${state.userData?.phone || ''}" placeholder="+960 333 6699" id="phone" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-input" value="${state.userData?.email || ''}" placeholder="email@example.com" id="email" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Delivery Address *</label>
                                <textarea class="form-input" placeholder="Street Address, Building, Floor, Apartment" id="address" rows="3" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Delivery Instructions (Optional)</label>
                                <textarea class="form-input" placeholder="e.g., Leave at door, Call before delivery" id="instructions" rows="2"></textarea>
                            </div>
                        </div>
                        
                        <div class="checkout-section mt-3">
                            <h3 class="section-title">Payment Method</h3>
                            
                            <div class="payment-methods" id="paymentMethods">
                                <div class="payment-method selected" data-method="bank_transfer">
                                    <div class="payment-icon">
                                        <i class="fas fa-university"></i>
                                    </div>
                                    <div class="payment-details">
                                        <div class="payment-name">Bank Transfer</div>
                                        <div class="payment-desc">Transfer to our bank account (Bank of Maldives)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: var(--gray-100); border-radius: var(--radius-md); padding: 1rem; margin-top: 1rem;" id="bankTransferNote">
                                <p style="color: var(--gray-700); font-size: 0.875rem;">
                                    <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                                    After placing order, you'll receive bank transfer details. Please complete payment within 24 hours.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="checkout-section">
                            <h3 class="section-title">Order Summary</h3>
                            
                            <div style="max-height: 200px; overflow-y: auto; margin-bottom: 1.5rem;">
                                ${cartItems.map(item => `
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-200);">
                                        <div>
                                            <div style="font-weight: 500; font-size: 0.875rem;">${item.name}</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-500);">Qty: ${item.quantity}</div>
                                        </div>
                                        <div style="font-weight: 600;">${formatCurrency(item.price * item.quantity)}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span>${formatCurrency(subtotal)}</span>
                            </div>
                            
                            <div class="summary-row">
                                <span>Delivery</span>
                                <span>${shipping === 0 ? 'FREE' : formatCurrency(shipping)}</span>
                            </div>
                            
                            <div class="summary-row">
                                <span>Tax (6%)</span>
                                <span>${formatCurrency(tax)}</span>
                            </div>
                            
                            <div class="summary-row total">
                                <span>Total</span>
                                <span class="value">${formatCurrency(total)}</span>
                            </div>
                            
                            <button class="btn btn-primary checkout-btn" id="placeOrderBtn">
                                <i class="fas fa-check-circle"></i>
                                Place Order & Get Bank Details
                            </button>
                            
                            <button class="btn btn-outline mt-2" onclick="loadPage('cart')" style="width: 100%;">
                                <i class="fas fa-arrow-left"></i>
                                Back to Cart
                            </button>
                        </div>
                    </div>
                </div>
                `}
            `;
            
            if (canCheckout) {
                document.getElementById('placeOrderBtn').addEventListener('click', () => {
                    const fullName = document.getElementById('fullName').value;
                    const phone = document.getElementById('phone').value;
                    const email = document.getElementById('email').value;
                    const address = document.getElementById('address').value;
                    const instructions = document.getElementById('instructions').value;
                    
                    if (!fullName || !phone || !email || !address) {
                        alert('Please fill in all required fields (marked with *)');
                        return;
                    }
                    
                    const order = {
                        customer: { fullName, phone, email, address, instructions },
                        items: cartItems.map(item => ({
                            id: item.id,
                            name: item.name,
                            price: item.price,
                            quantity: item.quantity,
                            image: item.image
                        })),
                        paymentMethod: 'bank_transfer',
                        subtotal,
                        shipping,
                        tax,
                        total,
                        status: 'pending',
                        paymentStatus: 'pending_review',
                        createdAt: new Date().toISOString()
                    };
                    
                    state.pendingOrder = order;
                    
                    const orderId = showBankTransferModal(generateOrderId(), total);
                    order.orderId = orderId;
                });
            }
        }

        function renderOrderConfirmation() {
            if (!state.orderDetails) {
                loadPage('home');
                return;
            }
            
            const order = state.orderDetails;
            
            mainContent.innerHTML = `
                <div class="empty-state">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--success) 0%, #27ae60 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                        <i class="fas fa-check" style="font-size: 3rem; color: white;"></i>
                    </div>
                    
                    <h1>Order Confirmed!</h1>
                    <p>Thank you for your grocery order #${order.orderId || order.id.substring(0, 8).toUpperCase()}</p>
                    
                    <div class="checkout-section mt-3" style="max-width: 500px; margin: 0 auto;">
                        <div class="summary-row">
                            <span>Order Number</span>
                            <span>${order.orderId || order.id.substring(0, 8).toUpperCase()}</span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Payment Method</span>
                            <span>Bank Transfer</span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Payment Status</span>
                            <span style="color: var(--warning); font-weight: 600;">Under Review</span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Order Status</span>
                            <span style="color: var(--warning);">Pending</span>
                        </div>
                        
                        <div class="summary-row total">
                            <span>Total Amount</span>
                            <span class="value">${formatCurrency(order.total)}</span>
                        </div>
                    </div>
                    
                    <div style="background: var(--gray-100); border-radius: var(--radius-md); padding: 1.5rem; margin-top: 1.5rem; max-width: 500px;">
                        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--dark);">
                            <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                            Next Steps:
                        </h3>
                        <ol style="color: var(--gray-600); padding-left: 1.5rem; line-height: 1.6;">
                            <li>Complete bank transfer using the provided details</li>
                            <li>Upload payment receipt in the payment section</li>
                            <li>We'll verify payment and process your order</li>
                            <li>You'll receive delivery confirmation via phone</li>
                        </ol>
                        <p style="color: var(--warning); font-weight: 600; margin-top: 1rem; padding: 0.75rem; background: rgba(243, 156, 18, 0.1); border-radius: var(--radius-md);">
                            <i class="fas fa-clock"></i> Your payment is under review. We'll update you once verified.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; justify-content: center;">
                        <button class="btn btn-primary" onclick="loadPage('home')">
                            <i class="fas fa-home"></i>
                            Back to Home
                        </button>
                        
                        <button class="btn btn-outline" onclick="showBankTransferModal('${order.orderId}', ${order.total})">
                            <i class="fas fa-university"></i>
                            View Bank Details Again
                        </button>
                        
                        <button class="btn btn-outline" onclick="loadPage('orders')">
                            <i class="fas fa-shopping-bag"></i>
                            View My Orders
                        </button>
                    </div>
                </div>
            `;
        }

        async function renderOrdersPage() {
            if (!state.currentUser) {
                showAuthModal();
                return;
            }
            
            try {
                const snapshot = await database.ref('orders').orderByChild('userId').equalTo(state.currentUser.uid).once('value');
                const ordersData = snapshot.val();
                const orders = ordersData ? Object.keys(ordersData).map(key => ({ id: key, ...ordersData[key] })) : [];
                
                // Sort by date (newest first)
                orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                mainContent.innerHTML = `
                    <div class="page-header">
                        <h1>My Orders</h1>
                        <p>${orders.length} order${orders.length !== 1 ? 's' : ''} placed</p>
                    </div>
                    
                    ${orders.length > 0 ? `
                        <div class="orders-list">
                            ${orders.map(order => `
                                <div class="order-card">
                                    <div class="order-header">
                                        <div>
                                            <div class="order-id">Order #${order.orderId || order.id.substring(0, 8).toUpperCase()}</div>
                                            <div class="order-date">${new Date(order.createdAt).toLocaleDateString()} at ${new Date(order.createdAt).toLocaleTimeString()}</div>
                                        </div>
                                        <div>
                                            <span class="order-status status-${order.status}">
                                                ${order.status.replace('_', ' ').toUpperCase()}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div style="color: var(--gray-600); margin: 1rem 0; padding: 1rem; background: var(--gray-100); border-radius: var(--radius-md);">
                                        <div><strong>Payment Status:</strong> 
                                            <span style="color: ${order.paymentStatus === 'pending_review' ? 'var(--warning)' : order.paymentStatus === 'completed' ? 'var(--success)' : 'var(--danger)'}; font-weight: 600;">
                                                ${order.paymentStatus === 'pending_review' ? 'Under Review' : order.paymentStatus.toUpperCase()}
                                            </span>
                                        </div>
                                        <div><strong>Delivery Address:</strong> ${order.customer?.address || 'N/A'}</div>
                                    </div>
                                    
                                    <div class="order-items">
                                        ${order.items.map(item => `
                                            <div class="order-item">
                                                <div>${item.quantity} x ${item.name}</div>
                                                <div>${formatCurrency(item.price * item.quantity)}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div class="order-total">
                                        <span>Total</span>
                                        <span>${formatCurrency(order.total)}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <h3>No orders yet</h3>
                            <p>Start shopping and place your first order</p>
                            <button class="btn btn-primary" onclick="loadPage('products')">
                                <i class="fas fa-store"></i>
                                Browse Products
                            </button>
                        </div>
                    `}
                `;
            } catch (error) {
                mainContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon" style="background: linear-gradient(135deg, var(--danger) 0%, #e74c3c 100%);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Error loading orders</h3>
                        <p>${error.message}</p>
                        <button class="btn btn-primary" onclick="renderOrdersPage()">
                            <i class="fas fa-redo"></i>
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        function renderSalePage() {
            const saleProducts = state.products.filter(product => 
                product.original_price && product.original_price > product.price
            );
            
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>Weekly Specials</h1>
                    <p>Limited time deals on fresh groceries</p>
                </div>
                
                <div style="background: linear-gradient(135deg, var(--danger) 0%, #e74c3c 100%); border-radius: var(--radius-lg); padding: 1.5rem; color: white; margin-bottom: 2rem;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Weekly Flash Sale</h2>
                            <p>Fresh discounts every week</p>
                        </div>
                        <div style="background: white; padding: 0.75rem 1rem; border-radius: var(--radius-md); color: var(--danger);">
                            <div style="font-size: 0.75rem; font-weight: 600;">SALE ENDS IN</div>
                            <div id="countdown" style="font-size: 1.25rem; font-weight: 800;">02:15:30</div>
                        </div>
                    </div>
                </div>
                
                ${saleProducts.length > 0 ? `
                    <div class="products-grid">
                        ${renderProductCards(saleProducts)}
                    </div>
                ` : `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-tag"></i>
                        </div>
                        <h3>No current specials</h3>
                        <p>Check back next week for new deals</p>
                    </div>
                `}
            `;
            
            startCountdown();
        }

        function renderAccountPage() {
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>My Account</h1>
                    <p>Manage your grocery orders and preferences</p>
                </div>
                
                <div class="checkout-section">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                        <div style="text-align: center; padding: 1.5rem; background: var(--gray-100); border-radius: var(--radius-md);">
                            <i class="fas fa-history" style="font-size: 2rem; color: var(--primary); margin-bottom: 1rem;"></i>
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">Order History</h3>
                            <p style="color: var(--gray-600);">View past orders</p>
                        </div>
                        
                        <div style="text-align: center; padding: 1.5rem; background: var(--gray-100); border-radius: var(--radius-md);">
                            <i class="fas fa-heart" style="font-size: 2rem; color: var(--primary); margin-bottom: 1rem;"></i>
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">Favorites</h3>
                            <p style="color: var(--gray-600);">Saved items</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" value="${state.userData?.fullName || ''}" id="accountName">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" value="${state.userData?.email || ''}" id="accountEmail" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" value="${state.userData?.phone || ''}" id="accountPhone">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Default Delivery Address</label>
                        <textarea class="form-input" placeholder="Your default address" rows="3" id="accountAddress"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%;" onclick="updateAccount()">
                        <i class="fas fa-save"></i>
                        Save Preferences
                    </button>
                    
                    <button class="btn btn-outline mt-2" style="width: 100%;" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            `;
        }

        async function updateAccount() {
            const name = document.getElementById('accountName').value;
            const phone = document.getElementById('accountPhone').value;
            const address = document.getElementById('accountAddress').value;
            
            try {
                await database.ref(`users/${state.currentUser.uid}`).update({
                    fullName: name,
                    phone: phone,
                    defaultAddress: address,
                    updatedAt: new Date().toISOString()
                });
                
                // Update local state
                state.userData.fullName = name;
                state.userData.phone = phone;
                state.userData.defaultAddress = address;
                
                updateUserInterface(true);
                updateSidebarUserInfo();
                showNotification('Account updated successfully!');
            } catch (error) {
                showNotification('Error updating account: ' + error.message, 'error');
            }
        }

        function renderContactPage() {
            mainContent.innerHTML = `
                <div class="page-header">
                    <h1>Contact Us</h1>
                    <p>Get in touch with our team for any inquiries</p>
                </div>
                
                <div class="contact-grid">
                    <div class="contact-info-card">
                        <div class="contact-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <h3 class="contact-card-title">Call Us</h3>
                        <p class="contact-card-text">Speak directly with our customer service team</p>
                        <a href="tel:+9607468757" class="contact-card-link">
                            <i class="fas fa-phone"></i>
                            +960 7468757
                        </a>
                    </div>
                    
                    <div class="contact-info-card">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3 class="contact-card-title">Email Us</h3>
                        <p class="contact-card-text">Send us an email for any questions or feedback</p>
                        <a href="mailto:info@aleelatrade.com.mv" class="contact-card-link">
                            <i class="fas fa-envelope"></i>
                            info@aleelatrade.com.mv
                        </a>
                    </div>
                    
                    <div class="contact-info-card">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3 class="contact-card-title">Visit Store</h3>
                        <p class="contact-card-text">Come visit our physical store location</p>
                        <button class="contact-card-link" onclick="showMapModal()" style="border: none; background: none; cursor: pointer;">
                            <i class="fas fa-map-marker-alt"></i>
                            View Store Location
                        </button>
                    </div>
                    
                    <div class="contact-info-card">
                        <div class="contact-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3 class="contact-card-title">Live Chat</h3>
                        <p class="contact-card-text">Chat with our support team in real-time</p>
                        <button class="contact-card-link" onclick="alert('Live chat service coming soon!')" style="border: none; background: none; cursor: pointer;">
                            <i class="fas fa-comment-dots"></i>
                            Start Chat
                        </button>
                    </div>
                </div>
                
                <!-- Business Hours -->
                <div class="business-hours">
                    <h3 class="hours-title">Business Hours</h3>
                    <div class="hours-grid">
                        <div class="hours-row">
                            <span class="hours-day">Monday - Friday</span>
                            <span class="hours-time">7:00 AM - 11:00 PM</span>
                        </div>
                        <div class="hours-row">
                            <span class="hours-day">Saturday</span>
                            <span class="hours-time">7:00 AM - 11:00 PM</span>
                        </div>
                        <div class="hours-row">
                            <span class="hours-day">Sunday</span>
                            <span class="hours-time">7:00 AM - 11:00 PM</span>
                        </div>
                        <div class="hours-row">
                            <span class="hours-day">Delivery Hours</span>
                            <span class="hours-time">7:00 AM - 10:00 PM</span>
                        </div>
                    </div>
                </div>
                
                <!-- Contact Form -->
                <div class="checkout-section mt-3">
                    <h3 class="section-title">Send Us a Message</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Your Name *</label>
                        <input type="text" class="form-input" placeholder="Full Name" id="contactName">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" class="form-input" placeholder="your@email.com" id="contactEmail">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" placeholder="+960 7468757" id="contactPhone">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <select class="form-input" id="contactSubject">
                            <option value="">Select a subject</option>
                            <option value="order">Order Inquiry</option>
                            <option value="delivery">Delivery Issue</option>
                            <option value="product">Product Question</option>
                            <option value="feedback">Feedback</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Message *</label>
                        <textarea class="form-input" placeholder="How can we help you?" rows="5" id="contactMessage"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%;" onclick="submitContactForm()">
                        <i class="fas fa-paper-plane"></i>
                        Send Message
                    </button>
                </div>
            `;
        }

        function submitContactForm() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const phone = document.getElementById('contactPhone').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            if (!name || !email || !message) {
                alert('Please fill in all required fields (Name, Email, Message)');
                return;
            }
            
            // Save contact message to database
            database.ref('contactMessages').push({
                name,
                email,
                phone,
                subject,
                message,
                createdAt: new Date().toISOString(),
                status: 'unread'
            })
            .then(() => {
                showNotification('Message sent successfully! We\'ll get back to you soon.');
                
                document.getElementById('contactName').value = '';
                document.getElementById('contactEmail').value = '';
                document.getElementById('contactPhone').value = '';
                document.getElementById('contactSubject').value = '';
                document.getElementById('contactMessage').value = '';
            })
            .catch(error => {
                showNotification('Error sending message: ' + error.message, 'error');
            });
        }

        // ===== UTILITY FUNCTIONS =====
        function getStockClass(stock) {
            if (stock > 20) return 'stock-in';
            if (stock > 0) return 'stock-low';
            return 'stock-out';
        }

        function getStockIcon(stock) {
            if (stock > 20) return 'fa-check-circle';
            if (stock > 0) return 'fa-exclamation-circle';
            return 'fa-times-circle';
        }

        function getStockText(stock) {
            if (stock > 20) return 'In Stock';
            if (stock > 0) return `Low Stock (${stock})`;
            return 'Out of Stock';
        }

        function updateActiveNav() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === state.currentPage) {
                    link.classList.add('active');
                }
            });
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === state.currentCategory || 
                    (!state.currentCategory && btn.dataset.category === 'all')) {
                    btn.classList.add('active');
                }
            });
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            if (!countdownElement) return;
            
            let hours = 2;
            let minutes = 15;
            let seconds = 30;
            
            const timer = setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                    if (minutes < 0) {
                        minutes = 59;
                        hours--;
                        if (hours < 0) {
                            clearInterval(timer);
                            countdownElement.textContent = "SALE ENDED";
                            return;
                        }
                    }
                }
                
                countdownElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // ===== CART FUNCTIONS =====
        function addToCart(productId, quantity = 1) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;
            
            if (quantity < 1) quantity = 1;
            if (quantity > product.stock) {
                alert(`Only ${product.stock} items available in stock`);
                quantity = product.stock;
            }
            
            state.cart[productId] = (state.cart[productId] || 0) + quantity;
            saveCart();
            updateCartCount();
            
            showNotification(`${product.name} added to cart`);
        }

        function updateQuantity(productId, quantity) {
            quantity = parseInt(quantity);
            if (isNaN(quantity) || quantity < 1) {
                quantity = 1;
            }
            
            const product = state.products.find(p => p.id === productId);
            if (product && quantity > product.stock) {
                alert(`Only ${product.stock} items available in stock`);
                quantity = product.stock;
            }
            
            state.cart[productId] = quantity;
            saveCart();
            updateCartCount();
            
            if (state.currentPage === 'cart') {
                loadPage('cart');
            }
        }

        function removeFromCart(productId) {
            delete state.cart[productId];
            saveCart();
            updateCartCount();
            loadPage('cart');
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(state.cart));
        }

        function updateCartCount() {
            const count = Object.values(state.cart).reduce((sum, qty) => sum + qty, 0);
            cartBadge.textContent = count;
            cartBadge.style.display = count > 0 ? 'flex' : 'none';
        }

        function printOrder() {
            window.print();
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 1rem;
                right: 1rem;
                background: ${type === 'error' ? 'var(--danger)' : 'var(--dark)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 9999;
                transform: translateX(120%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                max-width: 300px;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(120%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ===== INITIALIZE APP =====
        window.addEventListener('DOMContentLoaded', init);

        // Make functions globally available
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
        window.showProductDetails = showProductDetails;
        window.loadPage = loadPage;
        window.printOrder = printOrder;
        window.showBankTransferModal = showBankTransferModal;
        window.showMapModal = showMapModal;
        window.getDirections = getDirections;
        window.showAboutUsModal = showAboutUsModal;
        window.submitContactForm = submitContactForm;
        window.toggleFavorite = toggleFavorite;
        window.clearAllFavorites = clearAllFavorites;
        window.showAuthModal = showAuthModal;
        window.handleLogout = handleLogout;
        window.updateAccount = updateAccount;
    </script>
   <!-- In the main HTML file, update the showMapModal function to include iframe -->
<script>
function showMapModal() {
    mapModal.classList.add('active');
    
    // Update the map content to include iframe
    const mapContent = document.querySelector('.map-content');
    mapContent.innerHTML = `
        <button class="modal-close" id="mapModalClose">
            <i class="fas fa-times"></i>
        </button>
        
        <!-- Google Maps iframe -->
        <div style="width: 100%; height: 400px; border-radius: var(--radius-lg) var(--radius-lg) 0 0; overflow: hidden;">
            <iframe 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4747.891462512013!2d73.43478827569665!3d0.7510560992416458!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3b4a77c6b334236b%3A0x643c7c474c910b2c!2sALEELA%20TRADE!5e1!3m2!1sen!2smv!4v1768677267413!5m2!1sen!2smv" 
                width="100%" 
                height="100%" 
                style="border:0;" 
                allowfullscreen="" 
                loading="lazy" 
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
        
        <div class="map-info">
            <h3 class="map-title">Aleela Trade Store Location</h3>
            <p><strong>Address:</strong> Male, Male City, Maldives</p>
            <p><strong>Phone:</strong> +960 7468757</p>
            <p><strong>Hours:</strong> 7:00 AM - 11:00 PM Daily</p>
            
            <div class="map-actions">
                <a href="https://maps.google.com/?q=0.7510560992416458,73.43478827569665" 
                   target="_blank" 
                   class="btn btn-primary">
                    <i class="fas fa-directions"></i>
                    Get Directions
                </a>
                <button class="btn btn-outline" id="closeMapBtn">
                    Close
                </button>
            </div>
        </div>
    `;
    
    // Re-attach event listeners
    document.getElementById('mapModalClose').addEventListener('click', () => {
        mapModal.classList.remove('active');
    });
    
    document.getElementById('closeMapBtn').addEventListener('click', () => {
        mapModal.classList.remove('active');
    });
}
</script>
</body>
</html>
